FROM python:3.9-slim

WORKDIR /app

# Install dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy proto files and generated code
COPY two_phase_commit.proto .
COPY two_phase_commit_pb2.py .
COPY two_phase_commit_pb2_grpc.py .

# Copy coordinator code
COPY coordinator.py .

# Expose port
EXPOSE 50050

# Run coordinator
CMD ["python", "coordinator.py"]